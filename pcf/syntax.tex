\section{Синтаксис}

\newcommand{\rename}[2]{\{\vv{#1}/\vv{#2}\}}

\newcommand{\fv}{\texttt{fv}}

\begin{itemize}
\item
  Типове
  \[\vv{a} ::= \vv{nat}\ |\ \vv{a} \to \vv{a}.\]
  Когато пишем
  $\vv{a} \to \vv{b} \to \vv{c}$, то имаме предвид, че
  $\vv{a} \to (\vv{b} \to \vv{c})$.
\item
  Изрази
  \[\tau ::= \vv{n}\ |\ \vv{x}\ |\ \tau + \tau\ |\ \tau\ \vv{==}\ \tau\ |\ \ifelse{\tau}{\tau}{\tau}\ |\ \tau\tau\ |\ \lamb{x}{a}{\tau}\ |\ \fix(\tau).\]
  Ще означаваме съвкупоността от всички изрази с $\mathcal{E}$, а съвкупността от всички променливи с $\mathcal{V}$.
  Да обърнем внимание, че не всички изрази са ,,смислени''. Например,
  $\lamb{x}{nat}{\vv{xx}}$ не е ясно какво означава.
  
  Понеже тук вече имам свободни и свързани променливи, трябва да дефинираме точно какво означава това.
  \[\fv:\mathcal{E} \to \mathcal{P}(\mathcal{V})\]
  Ще дефинираме функцията $\texttt{fv}$ със структурна индукция по построението на термовете.
  
  \begin{itemize}
  \item
    $\fv(\vv{n}) = \emptyset$;
  \item
    $\fv(\vv{x}) = \{\vv{x}\}$;
  \item
    $\fv(\tau_1 + \tau_2) = \fv(\tau_1\ \vv{==}\ \tau_2) = \fv(\tau_1\tau_2) = \fv(\tau_1) \cup \fv(\tau_2)$;
  \item
    $\fv(\ifelse{\tau_1}{\tau_2}{\tau_3}) = \fv(\tau_1) \cup \fv(\tau_2) \cup \fv(\tau_3)$;
  \item
    $\fv(\lamb{x}{a}{\tau}) = \fv(\tau) \setminus \{x\}$.
  \item
    $\fv(\fix(\tau)) = \fv(\tau)$;
  \end{itemize}
  
  Ще казваме, че един израз $\tau$ е {\bf затворен}, ако $\fv(\tau) = \emptyset$.
  В противен случай, ще казваме, че изразът е {\bf отворен}.
\item
  \marginpar{или в канонична форма?}
  Ще казваме, че един израз е {\bf стойност}, ако той е съставен по следния начин:
  \[\vv{v} ::= \vv{n}\ |\ \lamb{x}{a}{\mu},\]
  където $\mu$ е затворен терм.
  С други думи, стойносттите са затворени термове, в които не е възможно да се правят повече опростявания.
  Например, $\vv{5 + 6}$ не е стойност, защото може да се опрости до $\vv{11}$,
  но $\lamb{x}{nat}{\vv{5+6}}$ е стойност.
\item
  Контексти
  \[\Gamma ::= \emptyset\ |\ \Gamma,\type{x}{a}.\]
  Когато имаме един израз 
\end{itemize}

С $\tau\rename{x}{u}$ ще означаваме изразът получен от $\tau$, в който всяко \emph{свободно} срещане на променливата $\vv{x}$
е заменена с променливата $\vv{u}$. Можем да дадем формална дефиниция с индукция по построението на изразите:
\begin{itemize}
\item
  Ако $\tau \equiv \vv{n}$, то $\tau\rename{x}{u}$ e израза $\vv{n}$.
\item
  Ако $\tau \equiv \vv{x}$, то $\tau\rename{x}{u}$ е израза $\vv{u}$.
\item
  Ако $\tau \equiv \vv{y}$ и $\vv{y}$ не е променливата $\vv{x}$, то $\tau\rename{x}{u}$ е израза $\vv{y}$.
\item
  Ако $\tau \equiv \tau_1 + \tau_2$, то
  $\tau\rename{x}{y}$ е израза $\tau_1\rename{x}{u} + \tau_2\rename{x}{u}$.
\item
  Ако $\tau$ е израза $\tau_1\ \vv{==}\ \tau_2$, то $\tau\rename{x}{u}$ е израза
  \[\tau_1\rename{x}{u}\ \vv{==}\ \tau_2\rename{x}{u}.\]
\item
  Ако $\tau$ е израза $\ifelse{\tau_1}{\tau_2}{\tau_3}$, то $\tau\rename{x}{u}$ е израза
  \[\ifelse{\tau_1\rename{x}{u}}{\tau_2\rename{x}{u}}{\tau_3\rename{x}{u}}.\]
\item
  Ако $\tau$ е израза $\lamb{x}{a}{\tau'}$, то
  $\tau\rename{x}{u}$ е израза $\tau$;
\item
  Ако $\tau$ е израза $\lamb{y}{a}{\tau'}$ и $\vv{y}$ е променлива различна от $\vv{x}$, то
  $\tau\rename{x}{u}$ е израза $\lamb{y}{a}{\tau'\rename{x}{u}}$;
\end{itemize}

Сега ще дефинираме бинарна релация между изрази, която ще наричаме $\alpha$-еквивалентност.
Това е най-малката релация $\equiv$ между изрази, за която са изпълнени свойствата:
\begin{itemize}
\item
  $\vv{x} \equiv \vv{x}$;
\item
  $\vv{n} \equiv \vv{n}$;
\item
  ако $\tau_1 \equiv \rho_1$ и $\tau_2 \equiv \rho_2$, то имаме, че
  \begin{align*}
    & \tau_1 + \tau_2 \equiv \rho_1 + \rho_2,\\
    & \tau_1\ \vv{==}\ \tau_2 \equiv \rho_1\ \vv{==}\ \rho_2,\\
    & \tau_1 \tau_2 \equiv \rho_1 \rho_2;
  \end{align*}
\item
  ако $\tau_1 \equiv \rho_1$, $\tau_2 \equiv \rho_2$ и $\tau_3 \equiv \rho_3$, то
  \[\ifelse{\tau_1}{\tau_2}{\tau_3} \equiv \ifelse{\rho_1}{\rho_2}{\rho_3};\]
\item
  ако $\tau \equiv \rho$, то $\fix(\tau) \equiv \fix(\rho)$;
\item
  ако $\tau\rename{x}{z} \equiv \rho\rename{y}{z}$, където $z \not\in \fv(\tau) \cup \fv(\rho)$, то
  \[\lamb{x}{a}{\tau} \equiv \lamb{y}{a}{\rho}.\]
\end{itemize}

В тази дефиниция единствено последният случай е интересен.
Според него, изразите $(\lamb{x}{a}{\vv{x+z}})\vv{x}$ и $(\lamb{y}{a}{\vv{y+z}})\vv{x}$ са еквивалентни.

Сега трябва да обобщим операцията преименуване на една променлива с друга с
операцията замяна на една променлива с израз.
Трябва да внимаваме как правим това, защото можем да получим
израз с различен смисъл.
% Например, нека $\tau_1$ е изразът $\lamb{x}{a}{xz}$,
% а $\tau_2$ е изразът $\lamb{y}{a}{yz}$. Ясно е, че $\tau_1 \equiv \tau_2$, т.е. двата израза описват един и същ терм.
% От друга страна обаче, нека $\rho$ е изразът $\lamb{x}{a}{yx}$. Тогава
% $\tau_1[z/\rho]$ е изразът
% \[\lamb{x}{a}{x(\lamb{x}{a}{yx})},\]
% а $\tau_2[z/\rho]$ е изразът
% \[\lamb{y}{a}{y(\lamb{x}{a}{yx})}.\]
% Лесно се съобразява, че
% \[\tau_1[z/\rho] \not\equiv \tau_2[z/\rho].\]
% Това означава, че ако не внимаваме, то след извършена замяна можем да получим различни термове в
% зависимост от това какъв представител на съответния терм сме избрали.

С $\tau\subst{x}{\rho}$ ще означаваме изразът получен от израза $\tau$, в който всяко \emph{свободно} срещане на променливата $\vv{x}$
е заменена с терма $\rho$. Можем да дадем формална дефиниция с индукция по построението на изразите:
\begin{itemize}
\item
  $\vv{n}\subst{x}{\rho}$ e израза $\vv{n}$.
\item
  Ако $\tau$ е израза $\vv{x}$, то $\tau\subst{x}{\rho}$ е израза $\rho$.
\item
  Ако $\tau$ е израза $\vv{y}$ и $\vv{y}$ различна променлива от $\vv{x}$, то $\tau\subst{x}{\rho}$ е израза $\vv{y}$.
\item
  Ако $\tau$ е израза $\tau_1 + \tau_2$, то
  $\tau\subst{x}{y}$ е израза $\tau_1\subst{x}{\rho} + \tau_2\subst{x}{\rho}$.
\item
  Ако $\tau$ е израза $\tau_1\ \vv{==}\ \tau_2$, то $\tau\subst{x}{\rho}$ е израза
  \[\tau_1\subst{x}{\rho}\ \vv{==}\ \tau_2\subst{x}{\rho}.\]
\item
  Ако $\tau$ е израза $\ifelse{\tau_1}{\tau_2}{\tau_3}$, то $\tau\subst{x}{\rho}$ е израза
  \[\ifelse{\tau_1\subst{x}{\rho}}{\tau_2\subst{x}{\rho}}{\tau_3\subst{x}{\rho}}.\]
\item
  Ако $\tau$ е израза $\lamb{x}{a}{\tau'}$, то
  $\tau\subst{x}{\rho}$ е израза $\tau$;
\item
  Ако $\tau$ е израза $\lamb{y}{a}{\tau'}$ и $\vv{y}$ е променлива различна от $\vv{x}$, то
  $\tau\subst{x}{\rho}$ е израза
  \[\lamb{z}{a}{(\tau'\rename{y}{z}\subst{x}{\rho})},\]
  където $\vv{z} \not\in \fv(\tau') \cup \fv(\rho) \cup \{x\}$.
\end{itemize}

В тази дефиниция отново единствено последният случай е интересен.
Обърнете внимание, че според него заместването на $\vv{x}$ с $\rho$ дава като резултат безкрайно много
изрази, всички от които са $\alpha$-еквивалентни.


PCF терм е клас на еквивалентност от PCF изрази относно релацията $\alpha$-еквивалентност.

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../sep"
%%% End:
